<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                   xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
                   xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
                   xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
                   id="Definitions_complex_message"
                   targetNamespace="http://bpmn.io/schema/bpmn">
  
  <bpmn:collaboration id="Collaboration_1">
    <bpmn:participant id="pool_customer" name="Customer" processRef="Process_Customer" />
    <bpmn:participant id="pool_supplier" name="Supplier" processRef="Process_Supplier" />
    
    <bpmn:messageFlow id="msg_order" name="Order" sourceRef="task_send_order" targetRef="task_receive_order" />
    <bpmn:messageFlow id="msg_quote" name="Quote Request" sourceRef="task_request_quote" targetRef="task_prepare_quote" />
    <bpmn:messageFlow id="msg_quote_response" name="Quote" sourceRef="task_send_quote" targetRef="task_review_quote" />
    <bpmn:messageFlow id="msg_confirm" name="Confirmation" sourceRef="task_send_confirmation" targetRef="task_receive_confirmation" />
  </bpmn:collaboration>
  
  <bpmn:process id="Process_Customer" isExecutable="false">
    <bpmn:laneSet>
      <bpmn:lane id="lane_customer" name="Customer Sales">
        <bpmn:flowNodeRef>start_customer</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_check_budget</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_request_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_review_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>gateway_approve</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_send_order</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_receive_confirmation</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_cancel</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>end_customer</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    
    <bpmn:startEvent id="start_customer" name="Start" />
    <bpmn:task id="task_check_budget" name="Check Budget" />
    <bpmn:task id="task_request_quote" name="Request Quote" />
    <bpmn:task id="task_review_quote" name="Review Quote" />
    <bpmn:exclusiveGateway id="gateway_approve" name="Approved?" />
    <bpmn:task id="task_send_order" name="Send Order" />
    <bpmn:task id="task_receive_confirmation" name="Receive Confirmation" />
    <bpmn:task id="task_cancel" name="Cancel Request" />
    <bpmn:endEvent id="end_customer" name="End" />
    
    <bpmn:sequenceFlow id="flow_c1" sourceRef="start_customer" targetRef="task_check_budget" />
    <bpmn:sequenceFlow id="flow_c2" sourceRef="task_check_budget" targetRef="task_request_quote" />
    <bpmn:sequenceFlow id="flow_c3" sourceRef="task_request_quote" targetRef="task_review_quote" />
    <bpmn:sequenceFlow id="flow_c4" sourceRef="task_review_quote" targetRef="gateway_approve" />
    <bpmn:sequenceFlow id="flow_c5" name="Yes" sourceRef="gateway_approve" targetRef="task_send_order" />
    <bpmn:sequenceFlow id="flow_c6" name="No" sourceRef="gateway_approve" targetRef="task_cancel" />
    <bpmn:sequenceFlow id="flow_c7" sourceRef="task_send_order" targetRef="task_receive_confirmation" />
    <bpmn:sequenceFlow id="flow_c8" sourceRef="task_receive_confirmation" targetRef="end_customer" />
    <bpmn:sequenceFlow id="flow_c9" sourceRef="task_cancel" targetRef="end_customer" />
  </bpmn:process>
  
  <bpmn:process id="Process_Supplier" isExecutable="false">
    <bpmn:laneSet>
      <bpmn:lane id="lane_supplier" name="Supplier Fulfillment">
        <bpmn:flowNodeRef>start_supplier</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_prepare_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_send_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_receive_order</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_check_inventory</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>gateway_available</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_prepare_shipment</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_order_stock</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_send_confirmation</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>end_supplier</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    
    <bpmn:startEvent id="start_supplier" name="Start" />
    <bpmn:task id="task_prepare_quote" name="Prepare Quote" />
    <bpmn:task id="task_send_quote" name="Send Quote" />
    <bpmn:task id="task_receive_order" name="Receive Order" />
    <bpmn:task id="task_check_inventory" name="Check Inventory" />
    <bpmn:exclusiveGateway id="gateway_available" name="Available?" />
    <bpmn:task id="task_prepare_shipment" name="Prepare Shipment" />
    <bpmn:task id="task_order_stock" name="Order Stock" />
    <bpmn:task id="task_send_confirmation" name="Send Confirmation" />
    <bpmn:endEvent id="end_supplier" name="End" />
    
    <bpmn:sequenceFlow id="flow_s1" sourceRef="start_supplier" targetRef="task_prepare_quote" />
    <bpmn:sequenceFlow id="flow_s2" sourceRef="task_prepare_quote" targetRef="task_send_quote" />
    <bpmn:sequenceFlow id="flow_s3" sourceRef="task_send_quote" targetRef="task_receive_order" />
    <bpmn:sequenceFlow id="flow_s4" sourceRef="task_receive_order" targetRef="task_check_inventory" />
    <bpmn:sequenceFlow id="flow_s5" sourceRef="task_check_inventory" targetRef="gateway_available" />
    <bpmn:sequenceFlow id="flow_s6" name="Yes" sourceRef="gateway_available" targetRef="task_prepare_shipment" />
    <bpmn:sequenceFlow id="flow_s7" name="No" sourceRef="gateway_available" targetRef="task_order_stock" />
    <bpmn:sequenceFlow id="flow_s8" sourceRef="task_order_stock" targetRef="task_prepare_shipment" />
    <bpmn:sequenceFlow id="flow_s9" sourceRef="task_prepare_shipment" targetRef="task_send_confirmation" />
    <bpmn:sequenceFlow id="flow_s10" sourceRef="task_send_confirmation" targetRef="end_supplier" />
  </bpmn:process>
  
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1">
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
