<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" 
                   xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" 
                   xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" 
                   xmlns:di="http://www.omg.org/spec/DD/20100524/DI" 
                   id="Definitions_1" 
                   targetNamespace="http://bpmn.io/schema/bpmn">
  
  <bpmn:collaboration id="Collaboration_1">
    <bpmn:participant id="customer_pool" name="Customer Company" processRef="customer_process"/>
    <bpmn:participant id="supplier_pool" name="Supplier Company" processRef="supplier_process"/>
    
    <!-- Message Flows removed for testing -->
  </bpmn:collaboration>
  
  <!-- Customer Process -->
  <bpmn:process id="customer_process" isExecutable="false">
    <bpmn:laneSet>
      <bpmn:lane id="lane_customer_sales" name="Sales Department">
        <bpmn:flowNodeRef>start_customer</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_request_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_review_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_send_order</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="lane_customer_procurement" name="Procurement">
        <bpmn:flowNodeRef>task_approve_order</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>gateway_approved</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_negotiate</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="lane_customer_finance" name="Finance">
        <bpmn:flowNodeRef>task_receive_invoice</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_process_payment</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>end_customer</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    
    <!-- Sales Department -->
    <bpmn:startEvent id="start_customer" name="Start"/>
    <bpmn:task id="task_request_quote" name="Request Quote"/>
    <bpmn:task id="task_review_quote" name="Review Quote"/>
    <bpmn:task id="task_send_order" name="Send Order"/>
    
    <!-- Procurement -->
    <bpmn:task id="task_approve_order" name="Approve Order"/>
    <bpmn:exclusiveGateway id="gateway_approved" name="Approved?"/>
    <bpmn:task id="task_negotiate" name="Negotiate Terms"/>
    
    <!-- Finance -->
    <bpmn:task id="task_receive_invoice" name="Receive Invoice"/>
    <bpmn:task id="task_process_payment" name="Process Payment"/>
    <bpmn:endEvent id="end_customer" name="End"/>
    
    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="flow_c1" sourceRef="start_customer" targetRef="task_request_quote"/>
    <bpmn:sequenceFlow id="flow_c2" sourceRef="task_request_quote" targetRef="task_review_quote"/>
    <bpmn:sequenceFlow id="flow_c3" sourceRef="task_review_quote" targetRef="task_approve_order"/>
    <bpmn:sequenceFlow id="flow_c4" sourceRef="task_approve_order" targetRef="gateway_approved"/>
    <bpmn:sequenceFlow id="flow_c5" sourceRef="gateway_approved" targetRef="task_send_order" name="Yes"/>
    <bpmn:sequenceFlow id="flow_c6" sourceRef="gateway_approved" targetRef="task_negotiate" name="No"/>
    <bpmn:sequenceFlow id="flow_c7" sourceRef="task_negotiate" targetRef="task_request_quote"/>
    <bpmn:sequenceFlow id="flow_c8" sourceRef="task_send_order" targetRef="task_receive_invoice"/>
    <bpmn:sequenceFlow id="flow_c9" sourceRef="task_receive_invoice" targetRef="task_process_payment"/>
    <bpmn:sequenceFlow id="flow_c10" sourceRef="task_process_payment" targetRef="end_customer"/>
  </bpmn:process>
  
  <!-- Supplier Process -->
  <bpmn:process id="supplier_process" isExecutable="false">
    <bpmn:laneSet>
      <bpmn:lane id="lane_supplier_sales" name="Sales Department">
        <bpmn:flowNodeRef>start_supplier</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_prepare_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_send_quote</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_receive_order</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="lane_supplier_warehouse" name="Warehouse">
        <bpmn:flowNodeRef>task_check_inventory</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>gateway_in_stock</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_prepare_shipment</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_send_confirmation</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="lane_supplier_accounting" name="Accounting">
        <bpmn:flowNodeRef>task_send_invoice</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>task_receive_confirmation</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>end_supplier</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    
    <!-- Sales Department -->
    <bpmn:startEvent id="start_supplier" name="Start"/>
    <bpmn:task id="task_prepare_quote" name="Prepare Quote"/>
    <bpmn:task id="task_send_quote" name="Send Quote"/>
    <bpmn:task id="task_receive_order" name="Receive Order"/>
    
    <!-- Warehouse -->
    <bpmn:task id="task_check_inventory" name="Check Inventory"/>
    <bpmn:exclusiveGateway id="gateway_in_stock" name="In Stock?"/>
    <bpmn:task id="task_prepare_shipment" name="Prepare Shipment"/>
    <bpmn:task id="task_send_confirmation" name="Send Confirmation"/>
    
    <!-- Accounting -->
    <bpmn:task id="task_send_invoice" name="Send Invoice"/>
    <bpmn:task id="task_receive_confirmation" name="Receive Confirmation"/>
    <bpmn:endEvent id="end_supplier" name="End"/>
    
    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="flow_s1" sourceRef="start_supplier" targetRef="task_prepare_quote"/>
    <bpmn:sequenceFlow id="flow_s2" sourceRef="task_prepare_quote" targetRef="task_send_quote"/>
    <bpmn:sequenceFlow id="flow_s3" sourceRef="task_send_quote" targetRef="task_receive_order"/>
    <bpmn:sequenceFlow id="flow_s4" sourceRef="task_receive_order" targetRef="task_check_inventory"/>
    <bpmn:sequenceFlow id="flow_s5" sourceRef="task_check_inventory" targetRef="gateway_in_stock"/>
    <bpmn:sequenceFlow id="flow_s6" sourceRef="gateway_in_stock" targetRef="task_prepare_shipment" name="Yes"/>
    <bpmn:sequenceFlow id="flow_s7" sourceRef="gateway_in_stock" targetRef="task_prepare_quote" name="No"/>
    <bpmn:sequenceFlow id="flow_s8" sourceRef="task_prepare_shipment" targetRef="task_send_confirmation"/>
    <bpmn:sequenceFlow id="flow_s9" sourceRef="task_send_confirmation" targetRef="task_send_invoice"/>
    <bpmn:sequenceFlow id="flow_s10" sourceRef="task_send_invoice" targetRef="task_receive_confirmation"/>
    <bpmn:sequenceFlow id="flow_s11" sourceRef="task_receive_confirmation" targetRef="end_supplier"/>
  </bpmn:process>
  
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1"/>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
